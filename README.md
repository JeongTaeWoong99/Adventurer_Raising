## ğŸ“‘ ëª©ì°¨
- [ê°œìš”](#ğŸ“‹-ê°œìš”)
- [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
- [ì¸ê²Œì„ ì‚¬ì§„](#ì¸ê²Œì„-ì‚¬ì§„)
- [ì‹œìŠ¤í…œ êµ¬ì¡°ë„](#ì‹œìŠ¤í…œ-êµ¬ì¡°ë„)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [ê´€ë ¨ ë§í¬](#ê´€ë ¨-ë§í¬)
- [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
- [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
- [ì„±ëŠ¥ íŠ¹ì„±](#ì„±ëŠ¥-íŠ¹ì„±)

## ğŸ“‹ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| ê¸°ê°„ | 2025.05 ~ 2025.08 |
| ì¸ì› | 1ì¸ ê°œë°œ |
| ì—­í•  | í´ë¼ì´ì–¸íŠ¸, ì„œë²„, DB |
| ë„êµ¬ | UNITY, C#, TCP SOCKET, FIREBASE |
| íƒ€ê²Ÿ ê¸°ê¸° | PC |

íŒíƒ€ì§€ ë°°ê²½ì˜ ì¿¼í„°ë·° 3D ë©€í‹° RPG ê²Œì„ì…ë‹ˆë‹¤. 

ë°ë””ì¼€ì´íŠ¸ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ì—¬, ë©€í‹°í”Œë ˆì´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

3D ê²Œì„ ê°œë°œ ë° ë„¤íŠ¸ì›Œí¬ ì‹œìŠ¤í…œì— ëŒ€í•œ ì „ë°˜ì ì¸ ì´í•´ë¥¼ ëª©ì ìœ¼ë¡œ, í´ë¼ì´ì–¸íŠ¸ë¶€í„° ì„œë²„ì™€ DBê¹Œì§€ ì§ì ‘ ì„¤ê³„í•˜ê³  êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### ì‹¤ì‹œê°„ ë©€í‹°í”Œë ˆì´ì–´
- **TCP ì†Œì¼“ í†µì‹ ** : ì„œë²„ì™€ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ 
- **ì´ì¤‘ í ì‹œìŠ¤í…œ** : ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œì™€ ë©”ì¸ ìŠ¤ë ˆë“œ ê°„ ì•ˆì „í•œ íŒ¨í‚· ì²˜ë¦¬
- **Dispatcher íŒ¨í„´** : Unity ë©”ì¸ ìŠ¤ë ˆë“œ ì œì•½ í•´ê²°
- **ë™ê¸°í™” ì „ëµ** : ì£¼ê¸°ì  ìœ„ì¹˜ ì—…ë°ì´íŠ¸ + ì¦‰ê° ì•¡ì…˜ íŒ¨í‚·

### íŒ¨í‚· í†µì‹  ì‹œìŠ¤í…œ
- **íŒ¨í‚· êµ¬ì¡°** : `[2ë°”ì´íŠ¸:í¬ê¸°][2ë°”ì´íŠ¸:íŒ¨í‚·ID][Në°”ì´íŠ¸:ë°ì´í„°]`
- **ì„œë²„ì™€ ë™ì¼í•œ íŒ¨í‚· ìŠ¤í™** : ìë™ ìƒì„± ì‹œìŠ¤í…œìœ¼ë¡œ ì¼ê´€ì„± ë³´ì¥
- **ë¹„ë™ê¸° ì†Œì¼“** : `SocketAsyncEventArgs` ê¸°ë°˜ ê³ ì„±ëŠ¥ I/O
- **íŒ¨í‚· ë°°ì¹­** : ì†¡ì‹  íë¡œ ì—¬ëŸ¬ íŒ¨í‚· ë¬¶ì–´ì„œ ì „ì†¡

### ê²Œì„ ì‹œìŠ¤í…œ
- **ì „íˆ¬ ì‹œìŠ¤í…œ** : ì½¤ë³´ ê³µê²©, QWER ìŠ¤í‚¬, íˆíŠ¸ íŒì •
- **ìºë¦­í„° ì‹œìŠ¤í…œ** : ë ˆë²¨, ê²½í—˜ì¹˜, ìŠ¤íƒ¯ ê´€ë¦¬
- **UI ì‹œìŠ¤í…œ** : Scene/Popup/SubItem/WorldSpace UI ê³„ì¸µ êµ¬ì¡°
- **ì—”í‹°í‹° ê´€ë¦¬** : í”Œë ˆì´ì–´, ëª¬ìŠ¤í„°, ì˜¤ë¸Œì íŠ¸ Dictionary ê¸°ë°˜ ê´€ë¦¬
- **ì±„íŒ… ì‹œìŠ¤í…œ** : ì‹¤ì‹œê°„ ì±„íŒ… ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸

### ì¸ì¦ ë° ë°ì´í„° ê´€ë¦¬
- **Firebase Authentication** : ê³„ì • ìƒì„± ë° ë¡œê·¸ì¸
- **Firebase Firestore** : í”Œë ˆì´ì–´ ë°ì´í„° ì˜êµ¬ ì €ì¥
- **í´ë¼ì´ì–¸íŠ¸ ìºì‹±** : JSON ê¸°ë°˜ ê²Œì„ ë°ì´í„° ê´€ë¦¬

## ğŸ¬ ì¸ê²Œì„ ì‚¬ì§„

<p align="center">
  <img width="700" height="579" alt="ìŠ¤í¬ë¦°ìƒ· 2025-09-14 204755" src="https://github.com/user-attachments/assets/49372a5e-1b98-4a70-a28d-34bbe83c4a65" />
</p>

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°ë„

<p align="center">
  <img width="1056" height="501" alt="image" src="https://github.com/user-attachments/assets/717bd5d7-3ba2-43a3-a8f7-1881c426f9b8" />
</p>

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Assets/Scripts/
â”œâ”€â”€ Client/                         # í´ë¼ì´ì–¸íŠ¸ ê²Œì„ ë¡œì§
â”‚   â”œâ”€â”€ Managers/
â”‚   â”‚   â”œâ”€â”€ ClientManager.cs        # ì¤‘ì•™ ë§¤ë‹ˆì € í—ˆë¸Œ (ì‹±ê¸€í†¤)
â”‚   â”‚   â”œâ”€â”€ Core/                   # í•µì‹¬ ë§¤ë‹ˆì €ë“¤
â”‚   â”‚   â”‚   â”œâ”€â”€ DataManager.cs      # JSON ë°ì´í„° íŒŒì‹± ë° ê´€ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ InputManager.cs     # ì´ë²¤íŠ¸ ê¸°ë°˜ ì…ë ¥ ì²˜ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ PoolManager.cs      # ì˜¤ë¸Œì íŠ¸ í’€ë§
â”‚   â”‚   â”‚   â”œâ”€â”€ ResourceManager.cs  # ë¦¬ì†ŒìŠ¤ ë¡œë“œ/ì¸ìŠ¤í„´ìŠ¤í™”
â”‚   â”‚   â”‚   â”œâ”€â”€ SceneManagerEx.cs   # ì”¬ ì „í™˜ ê´€ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ SoundManager.cs     # ì‚¬ìš´ë“œ ì¬ìƒ
â”‚   â”‚   â”‚   â””â”€â”€ UIManager.cs        # UI ìƒì„± ë° ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ Contents/               # ê²Œì„ ì»¨í…ì¸  ë§¤ë‹ˆì €ë“¤
â”‚   â”‚       â”œâ”€â”€ GameManagerEx.cs    # ê²Œì„ ìƒíƒœ ê´€ë¦¬
â”‚   â”‚       â”œâ”€â”€ DispatcherManagerEx.cs  # ìŠ¤ë ˆë“œ ì•ˆì „ ì•¡ì…˜ í
â”‚   â”‚       â”œâ”€â”€ ToolTipManager.cs   # íˆ´íŒ í‘œì‹œ
â”‚   â”‚       â””â”€â”€ FPSManager.cs       # í”„ë ˆì„ ëª¨ë‹ˆí„°ë§
â”‚   â”‚
â”‚   â”œâ”€â”€ Character Controllers/      # ì—”í‹°í‹° ì»¨íŠ¸ë¡¤ëŸ¬ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ BaseController.cs       # ì¶”ìƒ ê¸°ë°˜ í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ CommonPlayerController.cs  # ë‹¤ë¥¸ í”Œë ˆì´ì–´ (ì„œë²„ ë™ê¸°í™”)
â”‚   â”‚   â”œâ”€â”€ MyPlayerController.cs   # ë¡œì»¬ í”Œë ˆì´ì–´ (ì…ë ¥ ì²˜ë¦¬)
â”‚   â”‚   â”œâ”€â”€ MonsterController.cs    # ëª¬ìŠ¤í„° AI
â”‚   â”‚   â””â”€â”€ ObjectController.cs     # ìƒí˜¸ì‘ìš© ì˜¤ë¸Œì íŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ Contents/
â”‚   â”‚   â”œâ”€â”€ InfoState/              # ì—”í‹°í‹° ìƒíƒœ ê´€ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ InfoState.cs        # ê³µí†µ ìƒíƒœ (HP, ë ˆë²¨, ê²½í—˜ì¹˜)
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerInfoState.cs  # í”Œë ˆì´ì–´ ì „ìš© ìƒíƒœ
â”‚   â”‚   â”‚   â””â”€â”€ ObjectAndMonsterInfoState.cs  # ì˜¤ë¸Œì íŠ¸/ëª¬ìŠ¤í„° ìƒíƒœ
â”‚   â”‚   â”œâ”€â”€ Effects/
â”‚   â”‚   â”‚   â””â”€â”€ SkillMove.cs        # ìŠ¤í‚¬ ì´í™íŠ¸ ì´ë™ ë¡œì§
â”‚   â”‚   â””â”€â”€ Object/
â”‚   â”‚       â””â”€â”€ Portal.cs           # í¬í„¸ ì „í™˜
â”‚   â”‚
â”‚   â”œâ”€â”€ UI/                         # UI ì‹œìŠ¤í…œ
â”‚   â”‚   â”œâ”€â”€ UI_Base.cs              # UI ê¸°ë°˜ í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ UI_EventHandler.cs      # UI ì´ë²¤íŠ¸ ì²˜ë¦¬
â”‚   â”‚   â”œâ”€â”€ Scene/                  # ì”¬ UI (HUD, ì±„íŒ…, ìŠ¤í‚¬ë°”)
â”‚   â”‚   â”œâ”€â”€ Popup/                  # íŒì—… UI (ì¸ë²¤í† ë¦¬, ì„¤ì •)
â”‚   â”‚   â”œâ”€â”€ SubItem/                # ë™ì  ì•„ì´í…œ (ì±„íŒ… ë©”ì‹œì§€, ìŠ¬ë¡¯)
â”‚   â”‚   â””â”€â”€ WorldSpace/             # 3D UI (ì²´ë ¥ë°”, ë°ë¯¸ì§€ í…ìŠ¤íŠ¸)
â”‚   â”‚
â”‚   â”œâ”€â”€ Scenes/                     # ì”¬ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ BaseScene.cs            # ì”¬ ê¸°ë°˜ í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ Content/
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginScene.cs       # ë¡œê·¸ì¸ ì”¬
â”‚   â”‚   â”‚   â””â”€â”€ GameScene.cs        # ê²Œì„ ì”¬
â”‚   â”‚
â”‚   â”œâ”€â”€ Fuction Controllers/
â”‚   â”‚   â”œâ”€â”€ CameraController.cs     # ì¹´ë©”ë¼ ì¶”ì 
â”‚   â”‚   â””â”€â”€ CursorController.cs     # ì»¤ì„œ í‘œì‹œ
â”‚   â”‚
â”‚   â”œâ”€â”€ Data/
â”‚   â”‚   â””â”€â”€ Data.Contents.cs        # ë°ì´í„° í´ë˜ìŠ¤ ì •ì˜
â”‚   â”‚
â”‚   â””â”€â”€ Utils/                      # ìœ í‹¸ë¦¬í‹°
â”‚       â”œâ”€â”€ Define.cs               # Enum ì •ì˜
â”‚       â”œâ”€â”€ Extension.cs            # í™•ì¥ ë©”ì„œë“œ
â”‚       â””â”€â”€ Util.cs                 # í—¬í¼ í•¨ìˆ˜
â”‚
â”œâ”€â”€ Server/                         # ë„¤íŠ¸ì›Œí¬ í†µì‹  ë ˆì´ì–´
â”‚   â”œâ”€â”€ NetworkManager/
â”‚   â”‚   â”œâ”€â”€ NetworkManager.cs       # ë„¤íŠ¸ì›Œí¬ ë§¤ë‹ˆì € í—ˆë¸Œ
â”‚   â”‚   â”œâ”€â”€ PacketQueueManager.cs   # íŒ¨í‚· í (ìŠ¤ë ˆë“œ ì•ˆì „)
â”‚   â”‚   â”œâ”€â”€ ManagementPP.cs         # ì—”í‹°í‹° ìƒëª…ì£¼ê¸° íŒ¨í‚· ì²˜ë¦¬
â”‚   â”‚   â”œâ”€â”€ OperationPP.cs          # ì¡°ì‘ íŒ¨í‚· ì²˜ë¦¬
â”‚   â”‚   â”œâ”€â”€ DataBasePP.cs           # DB íŒ¨í‚· ì²˜ë¦¬
â”‚   â”‚   â””â”€â”€ NetworkStatsPP.cs       # ë„¤íŠ¸ì›Œí¬ í†µê³„
â”‚   â”‚
â”‚   â”œâ”€â”€ Packet/
â”‚   â”‚   â”œâ”€â”€ PacketHandler.cs        # íŒ¨í‚· í•¸ë“¤ëŸ¬ ë“±ë¡
â”‚   â”‚   â”œâ”€â”€ ClientPacketManager.cs  # íŒ¨í‚· ë§¤ë‹ˆì €
â”‚   â”‚   â””â”€â”€ GenPackets.cs           # ìë™ ìƒì„± íŒ¨í‚· í´ë˜ìŠ¤
â”‚   â”‚
â”‚   â”œâ”€â”€ ServerCore/                 # ì†Œì¼“ í†µì‹  ì½”ì–´
â”‚   â”‚   â”œâ”€â”€ Session.cs              # ë¹„ë™ê¸° ì†Œì¼“ ì„¸ì…˜
â”‚   â”‚   â”œâ”€â”€ Connector.cs            # ì„œë²„ ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ RecvBuffer.cs           # ìˆ˜ì‹  ë²„í¼
â”‚   â”‚   â””â”€â”€ SendBuffer.cs           # ì†¡ì‹  ë²„í¼
â”‚   â”‚
â”‚   â””â”€â”€ Session/
â”‚       â””â”€â”€ ServerSession.cs        # ì„œë²„ ì„¸ì…˜ êµ¬í˜„
â”‚
â””â”€â”€ DB/                             # Firebase ì—°ë™
    â”œâ”€â”€ AuthManager.cs              # ì¸ì¦ ê´€ë¦¬
    â”œâ”€â”€ DBManager.cs                # DB ì´ˆê¸°í™”
    â”œâ”€â”€ FirestoreManager.cs         # Firestore ì½ê¸°/ì“°ê¸°
    â””â”€â”€ RealTimeManager.cs          # ì‹¤ì‹œê°„ DB
```

## ğŸ”— ê´€ë ¨ ë§í¬

| í•­ëª© | ë§í¬                                                                   |
|------|----------------------------------------------------------------------|
| ì‹œì—° ì˜ìƒ | [ë°”ë¡œê°€ê¸°](https://www.youtube.com/watch?v=bL4QaUiaqw4&feature=youtu.be) |
| ì„œë²„ GitHub | [ë°”ë¡œê°€ê¸°](https://github.com/JeongTaeWoong99/Adventurer_Raising_Server) |

## âš™ï¸ ê¸°ìˆ  ìŠ¤íƒ

### í´ë¼ì´ì–¸íŠ¸
- **Unity 6000.0.44f1** - 3D ê²Œì„ ì—”ì§„
- **C# (.NET Framework)** - í”„ë¡œê·¸ë˜ë° ì–¸ì–´
- **Unity Addressables** - ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œ
- **Unity UI (uGUI)** - UI ì‹œìŠ¤í…œ

### ë„¤íŠ¸ì›Œí‚¹
- **TCP Socket** - ì‹¤ì‹œê°„ í†µì‹  í”„ë¡œí† ì½œ
- **SocketAsyncEventArgs** - ë¹„ë™ê¸° ì†Œì¼“ I/O
- **Custom Binary Protocol** - ìì²´ ì œì‘ íŒ¨í‚· ì§ë ¬í™”

### ë°ì´í„°ë² ì´ìŠ¤
- **Firebase Authentication** - ê³„ì • ì¸ì¦
- **Firebase Firestore** - NoSQL í”Œë ˆì´ì–´ ë°ì´í„° ì €ì¥
- **Firebase Realtime Database** - ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”

### ë””ìì¸ íŒ¨í„´
- **Singleton Pattern** - ë§¤ë‹ˆì € í´ë˜ìŠ¤
- **Factory Pattern** - UI ìƒì„±
- **Observer Pattern** - ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ
- **Object Pooling** - ì„±ëŠ¥ ìµœì í™”
- **Dispatcher Pattern** - ìŠ¤ë ˆë“œ ì•ˆì „ì„±

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### 1ï¸âƒ£ íŒ¨í‚· ì²˜ë¦¬ íë¦„

í´ë¼ì´ì–¸íŠ¸ëŠ” **ì´ì¤‘ í ì‹œìŠ¤í…œ**ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œì™€ Unity ë©”ì¸ ìŠ¤ë ˆë“œë¥¼ ë¶„ë¦¬í•©ë‹ˆë‹¤.

```
[ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œ - ë°±ê·¸ë¼ìš´ë“œ]
Socket.ReceiveAsync()
  â†“
Session.OnRecvCompleted()
  â†“
PacketSession.OnRecv()               # íŒ¨í‚· í—¤ë” íŒŒì‹± [í¬ê¸°][ID]
  â†“
ServerSession.OnRecvPacket()
  â†“
PacketQueueManager.Push(packet)      # ğŸ”’ Lockìœ¼ë¡œ íì— ì €ì¥

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Unity ë©”ì¸ ìŠ¤ë ˆë“œ - Update Loop]

NetworkManager.Update()
  â†“
PacketQueueManager.PopAll()          # ğŸ”’ Lockìœ¼ë¡œ íì—ì„œ êº¼ëƒ„
  â†“
PacketManager.HandlePacket()
  â†“
PacketHandler.S_*Handler()           # íŒ¨í‚· íƒ€ì…ë³„ í•¸ë“¤ëŸ¬ í˜¸ì¶œ
  â†“
Dispatcher.Push(lambda)              # Unity API í˜¸ì¶œ ì•¡ì…˜ íì‰

ClientManager.Update()
  â†“
Dispatcher.OnUpdate()                # íì‰ëœ ì•¡ì…˜ ì‹¤í–‰
  â†“
NetworkManager.Operation.EntityMove() # ì‹¤ì œ ê²Œì„ ë¡œì§ ì‹¤í–‰
```

**í•µì‹¬ ì„¤ê³„** :
1. **PacketQueueManager** : ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œì—ì„œ ìˆ˜ì‹ í•œ íŒ¨í‚·ì„ íì— ì €ì¥
2. **Dispatcher Pattern** : Unity APIëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œë§Œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë¯€ë¡œ ì•¡ì…˜ íë¡œ ë§ˆìƒ¬ë§
3. **Thread Safety** : Lock ê¸°ë°˜ ë™ê¸°í™”ë¡œ ë°ì´í„° ë ˆì´ìŠ¤ ë°©ì§€

### 2ï¸âƒ£ í•µì‹¬ ë””ìì¸ íŒ¨í„´

#### ì´ì¤‘ ë§¤ë‹ˆì € êµ¬ì¡°

í´ë¼ì´ì–¸íŠ¸ëŠ” **ClientManager**ì™€ **NetworkManager**ë¡œ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•©ë‹ˆë‹¤.

**ClientManager** - Unity ê²Œì„ ë¡œì§
```csharp
public class ClientManager : MonoBehaviour
{
    // Core ë§¤ë‹ˆì €
    DataManager     _data;      // JSON ë°ì´í„° ê´€ë¦¬
    InputManager    _input;     // ì…ë ¥ ì´ë²¤íŠ¸
    PoolManager     _pool;      // ì˜¤ë¸Œì íŠ¸ í’€ë§
    ResourceManager _resource;  // ë¦¬ì†ŒìŠ¤ ë¡œë“œ
    SceneManagerEx  _scene;     // ì”¬ ì „í™˜
    SoundManager    _sound;     // ì‚¬ìš´ë“œ ì¬ìƒ
    UIManager       _ui;        // UI ìƒì„±/ê´€ë¦¬

    // Contents ë§¤ë‹ˆì €
    GameManagerEx       _game;       // ê²Œì„ ìƒíƒœ
    DispatcherManagerEx _dispatcher; // ìŠ¤ë ˆë“œ ì•ˆì „ í
    ToolTipManager      _toolTip;    // íˆ´íŒ
    FPSManager          _fps;        // FPS ëª¨ë‹ˆí„°

    void Update()
    {
        _input.OnUpdate();
        _ui.OnUpdate();
        _toolTip.OnUpdate();
        _fps.OnUpdate();
        _dispatcher.OnUpdate();  // ë„¤íŠ¸ì›Œí¬ ì•¡ì…˜ ì‹¤í–‰
    }
}
```

**NetworkManager** - ë„¤íŠ¸ì›Œí¬ í†µì‹ 
```csharp
public class NetworkManager : MonoBehaviour
{
    ServerSession _session;  // TCP ì—°ê²°

    // íŒ¨í‚· ì²˜ë¦¬ ëª¨ë“ˆ (PP = Packet Processing)
    ManagementPP   _managementPP;    // ì—”í‹°í‹° ì…ì¥/í‡´ì¥/ì •ë³´ë³€ê²½
    OperationPP    _operationPP;     // ì´ë™/ê³µê²©/ìŠ¤í‚¬/ì±„íŒ…
    DataBasePP     _dataBasePP;      // ë¡œê·¸ì¸/íšŒì›ê°€ì…
    NetworkStatsPP _networkStatsPP;  // í•‘/íŒ¨í‚·ìˆ˜/ë°”ì´íŠ¸

    void Update()
    {
        // íŒ¨í‚· íì—ì„œ êº¼ë‚´ì„œ ì²˜ë¦¬
        List<IPacket> list = PacketQueueManager.Instance.PopAll();
        foreach(IPacket packet in list)
            PacketManager.Instance.HandlePacket(_session, packet);

        _networkStatsPP.UpdateStats();
    }
}
```

**ë¶„ë¦¬ ì´ìœ ** :
- ClientManager : Unity ê²Œì„ ë¡œì§ (ë¦¬ì†ŒìŠ¤, UI, ì”¬, ì‚¬ìš´ë“œ)
- NetworkManager : ë„¤íŠ¸ì›Œí¬ I/O ë° íŒ¨í‚· ì²˜ë¦¬
- ì¥ì : ëª¨ë“ˆí™”, í…ŒìŠ¤íŠ¸ ìš©ì´, ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬

#### Dispatcher íŒ¨í„´ (ìŠ¤ë ˆë“œ ì•ˆì „ì„±)

Unity APIëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œë§Œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë¯€ë¡œ, ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œì—ì„œ ë°›ì€ íŒ¨í‚·ì„ ë©”ì¸ ìŠ¤ë ˆë“œë¡œ ë§ˆìƒ¬ë§í•©ë‹ˆë‹¤.

```csharp
public class DispatcherManagerEx
{
    Queue<Action> _actionQueue = new Queue<Action>();
    object _lock = new object();

    // ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œì—ì„œ í˜¸ì¶œ
    public void Push(Action action)
    {
        lock (_lock)
        {
            _actionQueue.Enqueue(action);
        }
    }

    // ë©”ì¸ ìŠ¤ë ˆë“œ (Update)ì—ì„œ í˜¸ì¶œ
    public void OnUpdate()
    {
        lock (_lock)
        {
            while (_actionQueue.Count > 0)
            {
                Action action = _actionQueue.Dequeue();
                action.Invoke();  // Unity API í˜¸ì¶œ
            }
        }
    }
}
```

**ì‚¬ìš© ì˜ˆì‹œ** :
```csharp
// PacketHandler.cs (ë„¤íŠ¸ì›Œí¬ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰)
public static void S_BroadcastEntityMoveHandler(PacketSession session, IPacket packet)
{
    S_BroadcastEntityMove pkt = packet as S_BroadcastEntityMove;

    // Unity API í˜¸ì¶œì„ ë©”ì¸ ìŠ¤ë ˆë“œë¡œ ë§ˆìƒ¬ë§
    ClientManager.Dispatcher.Push(() => {
        NetworkManager.Operation.EntityMove(pkt);
    });
}
```

#### ìºë¦­í„° ì»¨íŠ¸ë¡¤ëŸ¬ ê³„ì¸µ êµ¬ì¡°

```
BaseController (Abstract)
â”œâ”€â”€ CommonPlayerController (ë‹¤ë¥¸ í”Œë ˆì´ì–´)
â”‚   â””â”€â”€ MyPlayerController (ë‚´ í”Œë ˆì´ì–´)
â”œâ”€â”€ MonsterController (ëª¬ìŠ¤í„°)
â””â”€â”€ ObjectController (ìƒí˜¸ì‘ìš© ì˜¤ë¸Œì íŠ¸)
```

**BaseController.cs** - ëª¨ë“  ì—”í‹°í‹°ì˜ ê³µí†µ ë¡œì§
```csharp
public abstract class BaseController : MonoBehaviour
{
    // ê³µí†µ ì»´í¬ë„ŒíŠ¸
    public Animator animator;
    public CharacterController characterController;
    public InfoState infoState;

    // ê³µí†µ ìƒíƒœ
    public Define.Anime anime;
    public Vector3 movePos;
    public int currentAttackComboNum;

    // ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ ë¨¸ì‹ 
    public Define.Anime Anime
    {
        set
        {
            anime = value;
            switch (anime)
            {
                case Define.Anime.Attack:
                    isAnimeMove = true;
                    animator.CrossFade("ATTACK" + currentAttackComboNum, 0.1f, -1, 0f);
                    break;
                // ...
            }
        }
    }

    void Update()
    {
        switch (Anime)
        {
            case Define.Anime.Idle:   UpdateIdle();   break;
            case Define.Anime.Run:    UpdateRun();    break;
            case Define.Anime.Attack: UpdateAttack(); break;
            // ...
        }

        // ì¤‘ë ¥ ì ìš©
        if (characterController) GroundGravityDirection();
    }

    // í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ êµ¬í˜„
    protected abstract void Init();
    protected virtual void UpdateIdle() { }
    protected virtual void UpdateRun() { }
    protected virtual void UpdateAttack() { }
}
```

**MyPlayerController.cs** - ë¡œì»¬ í”Œë ˆì´ì–´ (ì…ë ¥ ì²˜ë¦¬ + íŒ¨í‚· ì „ì†¡)
```csharp
public class MyPlayerController : CommonPlayerController
{
    protected override void Init()
    {
        // ì…ë ¥ ì´ë²¤íŠ¸ ë“±ë¡
        ClientManager.Input.MouseMoveAction -= OnMouseMoveEvent;
        ClientManager.Input.MouseMoveAction += OnMouseMoveEvent;
        ClientManager.Input.KeyAction -= OnKeyEvent;
        ClientManager.Input.KeyAction += OnKeyEvent;

        // ì£¼ê¸°ì  ìœ„ì¹˜ ë™ê¸°í™” (100ms)
        StartCoroutine(CoSendPacket());
    }

    // ìš°í´ë¦­ ì´ë™
    void OnMouseMoveEvent(Define.MouseEvent evt)
    {
        if (evt == Define.MouseEvent.Click)
        {
            Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
            if (Physics.Raycast(ray, out RaycastHit hit, 100.0f, groundLayer))
            {
                movePos = hit.point;
                Anime = Define.Anime.Run;

                // ì„œë²„ì— ì´ë™ íŒ¨í‚· ì „ì†¡
                C_EntityMove movePkt = new C_EntityMove();
                movePkt.posInfo = new PositionInfo { ... };
                NetworkManager.Instance.Send(movePkt.Write());
            }
        }
    }

    // ì¢Œí´ë¦­ ì½¤ë³´ ê³µê²©
    void OnMouseAttackEvent(Define.MouseEvent evt)
    {
        if (evt == Define.MouseEvent.Click && !isAttacking)
        {
            StartCoroutine(NormalAttackRoutine());
        }
    }

    IEnumerator NormalAttackRoutine()
    {
        // ê³µê²© ì• ë‹ˆë©”ì´ì…˜ íŒ¨í‚·
        C_EntityAttackAnimation attackPkt = new C_EntityAttackAnimation();
        attackPkt.comboNum = currentAttackComboNum;
        NetworkManager.Instance.Send(attackPkt.Write());

        yield return new WaitForSeconds(0.5f);
        currentAttackComboNum = (currentAttackComboNum % maxAttackComboNum) + 1;
    }
}
```

**CommonPlayerController.cs** - ë‹¤ë¥¸ í”Œë ˆì´ì–´ (ì„œë²„ ë™ê¸°í™”)
```csharp
public class CommonPlayerController : BaseController
{
    protected override void UpdateRun()
    {
        // ì„œë²„ì—ì„œ ë°›ì€ dir ë²¡í„°ë¡œ ì´ë™
        characterController.Move(dir * infoState.moveSpeed * Time.deltaTime);

        // ë¶€ë“œëŸ¬ìš´ íšŒì „
        if (dir != Vector3.zero)
        {
            Quaternion targetRotation = Quaternion.LookRotation(dir);
            transform.rotation = Quaternion.Slerp(transform.rotation, targetRotation, 10f * Time.deltaTime);
        }
    }
}
```

#### UI ì‹œìŠ¤í…œ ê³„ì¸µ êµ¬ì¡°

```
UI_Base (ì¶”ìƒ í´ë˜ìŠ¤)
â”œâ”€â”€ UI_Scene      # ì”¬ UI (HUD, ì±„íŒ…, ìŠ¤í‚¬ë°”)
â”œâ”€â”€ UI_Popup      # íŒì—… UI (ì¸ë²¤í† ë¦¬, ì„¤ì •)
â”œâ”€â”€ UI_SubItem    # ë™ì  ì•„ì´í…œ (ì±„íŒ… ë©”ì‹œì§€, ìŠ¬ë¡¯)
â””â”€â”€ UI_WorldSpace # 3D UI (ì²´ë ¥ë°”, ë°ë¯¸ì§€ í…ìŠ¤íŠ¸)
```

**UIManager.cs** - Factory íŒ¨í„´
```csharp
public class UIManager
{
    int _order = 10;
    Stack<UI_Popup> _popupStack = new Stack<UI_Popup>();

    public T ShowPopupUI<T>(string name = null) where T : UI_Popup
    {
        // í”„ë¦¬íŒ¹ì—ì„œ UI ìƒì„±
        GameObject go = ClientManager.Resource.R_Instantiate($"UI/Popup/{name}");
        T popup = Util.GetOrAddComponent<T>(go);

        // ìŠ¤íƒì— ì¶”ê°€ ë° sortingOrder ì¦ê°€
        _popupStack.Push(popup);
        popup.GetComponent<Canvas>().sortingOrder = _order++;

        return popup;
    }
}
```

**UI_Base.cs** - Enum ê¸°ë°˜ ìë™ ë°”ì¸ë”©
```csharp
public abstract class UI_Base : MonoBehaviour
{
    Dictionary<Type, UnityEngine.Object[]> _objects = new Dictionary<Type, UnityEngine.Object[]>();

    protected void Bind<T>(Type type) where T : UnityEngine.Object
    {
        string[] names = Enum.GetNames(type);
        UnityEngine.Object[] objects = new UnityEngine.Object[names.Length];

        for (int i = 0; i < names.Length; i++)
        {
            objects[i] = Util.FindChild<T>(gameObject, names[i], true);
        }

        _objects.Add(typeof(T), objects);
    }

    protected T Get<T>(int idx) where T : UnityEngine.Object
    {
        return _objects[typeof(T)][idx] as T;
    }
}
```

**ì‚¬ìš© ì˜ˆì‹œ** :
```csharp
public class UI_GameScene : UI_Scene
{
    enum Texts { PlayerName, Level, HP, EXP }
    enum Buttons { SkillQ, SkillW, SkillE, SkillR }

    public override void Init()
    {
        Bind<Text>(typeof(Texts));
        Bind<Button>(typeof(Buttons));

        Get<Text>((int)Texts.PlayerName).text = "Player1";
        Get<Button>((int)Buttons.SkillQ).onClick.AddListener(OnSkillQ);
    }
}
```

#### ì˜¤ë¸Œì íŠ¸ í’€ë§

**PoolManager.cs**
```csharp
public class PoolManager
{
    class Pool
    {
        public GameObject Original { get; private set; }
        public Stack<GameObject> _poolStack = new Stack<GameObject>();

        public void Push(GameObject go)
        {
            go.SetActive(false);
            _poolStack.Push(go);
        }

        public GameObject Pop(Transform parent)
        {
            GameObject go;
            if (_poolStack.Count > 0)
                go = _poolStack.Pop();
            else
                go = GameObject.Instantiate(Original, parent);

            go.SetActive(true);
            return go;
        }
    }

    Dictionary<string, Pool> _pools = new Dictionary<string, Pool>();
}
```

**ResourceManager.cs í†µí•©**
```csharp
public GameObject R_Instantiate(string path, Transform parent = null)
{
    GameObject original = R_Load<GameObject>(path);

    // Poolable ì»´í¬ë„ŒíŠ¸ê°€ ìˆìœ¼ë©´ í’€ì—ì„œ ê°€ì ¸ì˜´
    if (original.GetComponent<Poolable>() != null)
        return ClientManager.Pool.Pop(original, parent);

    return GameObject.Instantiate(original, parent);
}

public void R_Destroy(GameObject go)
{
    if (go.GetComponent<Poolable>() != null)
    {
        ClientManager.Pool.Push(go);  // í’€ë¡œ ë°˜í™˜
        return;
    }

    GameObject.Destroy(go);
}
```

### 3ï¸âƒ£ ë„¤íŠ¸ì›Œí¬ ë™ê¸°í™”

#### íŒ¨í‚· ì¹´í…Œê³ ë¦¬

**Database (DB)**
- `C_MakeId` / `S_MakeIdResult` - íšŒì›ê°€ì…
- `C_Login` / `S_LoginResult` - ë¡œê·¸ì¸

**Management (ê´€ë¦¬)**
- `S_BroadcastEntityList` - ì´ˆê¸° ë™ê¸°í™” (ì”¬ ì§„ì… ì‹œ ëª¨ë“  ì—”í‹°í‹°)
- `S_BroadcastEntityEnter` - ìƒˆ ì—”í‹°í‹° ì…ì¥
- `S_BroadcastEntityLeave` - ì—”í‹°í‹° í‡´ì¥
- `S_BroadcastEntityInfoChange` - HP/ë ˆë²¨/ê²½í—˜ì¹˜ ì—…ë°ì´íŠ¸

**Operation (ì¡°ì‘)**
- `C_EntityMove` / `S_BroadcastEntityMove` - ì´ë™
- `C_EntityRotation` / `S_BroadcastEntityRotation` - íšŒì „
- `C_EntityAnimation` / `S_BroadcastEntityAnimation` - ì• ë‹ˆë©”ì´ì…˜
- `C_EntityDash` / `S_BroadcastEntityDash` - ëŒ€ì‰¬
- `C_EntityAttackAnimation` / `S_BroadcastEntityAttackAnimation` - ê³µê²© ì• ë‹ˆë©”ì´ì…˜
- `S_BroadcastEntityAttackResult` - ê³µê²© ê²°ê³¼ (ë°ë¯¸ì§€, íˆíŠ¸)
- `S_BroadcastEntityAttackEffectCreate` - ìŠ¤í‚¬ ì´í™íŠ¸ ìƒì„±
- `C_Chatting` / `S_BroadcastChatting` - ì±„íŒ…

#### ë™ê¸°í™” ì „ëµ

**ì„œë²„ ê¶Œí•œ (Server Authority)**
- ì—”í‹°í‹° ìœ„ì¹˜ (ëª¬ìŠ¤í„°, ë‹¤ë¥¸ í”Œë ˆì´ì–´)
- ì²´ë ¥, ë°ë¯¸ì§€, ì „íˆ¬ ê²°ê³¼
- ì—”í‹°í‹° ìŠ¤í°/ë””ìŠ¤í°

**í´ë¼ì´ì–¸íŠ¸ ê¶Œí•œ (Client Authority)**
- ë¡œì»¬ í”Œë ˆì´ì–´ ì…ë ¥ ë° ì˜ˆì¸¡
- ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ (ì‹œê° íš¨ê³¼)
- ì´í™íŠ¸ ìƒì„± (ì‹œê° íš¨ê³¼)

**ì—…ë°ì´íŠ¸ ë¹ˆë„**
- **ìœ„ì¹˜** : 100ms (10 Hz) - ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
- **ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ** : ë³€í™” ì‹œì—ë§Œ - ëŒ€ì—­í­ ì ˆì•½
- **ì „íˆ¬ ì•¡ì…˜** : ì¦‰ê° (0ms ì§€ì—°) - ë°˜ì‘ì„±
- **ì—”í‹°í‹° ì •ë³´** : ì„œë²„ê°€ ë³€ê²½ ì‹œ ë¸Œë¡œë“œìºìŠ¤íŠ¸

**ì „íˆ¬ ì‹œìŠ¤í…œ íë¦„**

1. **í´ë¼ì´ì–¸íŠ¸ ì¸¡** :
   ```csharp
   // ê³µê²© ì‹œì‘
   C_EntityAttackAnimation attackPkt = new C_EntityAttackAnimation();
   attackPkt.comboNum = currentAttackComboNum;
   attackPkt.dir = transform.forward;
   NetworkManager.Instance.Send(attackPkt.Write());
   ```

2. **ì„œë²„ ì¸¡** :
   - ê³µê²© ê²€ì¦ (ì¿¨ë‹¤ìš´, ê±°ë¦¬, ìƒíƒœ)
   - ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— `S_BroadcastEntityAttackAnimation` ë¸Œë¡œë“œìºìŠ¤íŠ¸
   - íˆíŠ¸ íŒì • ê³„ì‚° (ê³µê²© ë²”ìœ„, ì¶©ëŒ ì²´í¬)
   - `S_BroadcastEntityAttackResult` ë¸Œë¡œë“œìºìŠ¤íŠ¸ (ë°ë¯¸ì§€, íƒ€ê²Ÿ ID)

3. **í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ** :
   ```csharp
   public void EntityAttackAnimation(S_BroadcastEntityAttackAnimation pkt)
   {
       if (playerDic.TryGetValue(pkt.id, out CommonPlayerController player))
       {
           player.currentAttackComboNum = pkt.comboNum;
           player.Anime = Define.Anime.Attack;
       }
   }

   public void EntityAttackResult(S_BroadcastEntityAttackResult pkt)
   {
       // ë°ë¯¸ì§€ ì ìš©
       targetInfoState.hp -= pkt.damage;

       // íˆíŠ¸ ì´í™íŠ¸ ìƒì„±
       ClientManager.Resource.R_Instantiate("Effect/HitEffect", targetPosition);
   }
   ```

#### ì—”í‹°í‹° ê´€ë¦¬

**ManagementPP.cs**
```csharp
public class ManagementPP
{
    public MyPlayerController myPlayerCon;
    public Dictionary<int, CommonPlayerController> playerDic = new Dictionary<int, CommonPlayerController>();
    public Dictionary<int, ObjectController> objectDic = new Dictionary<int, ObjectController>();
    public Dictionary<int, MonsterController> monsterDic = new Dictionary<int, MonsterController>();

    // ì´ˆê¸° ë™ê¸°í™” (ì”¬ ì§„ì… ì‹œ)
    public void EntityList(S_BroadcastEntityList pkt)
    {
        foreach (var entity in pkt.players)
        {
            if (entity.isSelf)
            {
                // ë‚´ í”Œë ˆì´ì–´ ìƒì„±
                GameObject go = ClientManager.Resource.R_Instantiate("Player/MyPlayer");
                myPlayerCon = go.GetComponent<MyPlayerController>();
                myPlayerCon.ID = entity.id;
            }
            else
            {
                // ë‹¤ë¥¸ í”Œë ˆì´ì–´ ìƒì„±
                GameObject go = ClientManager.Resource.R_Instantiate("Player/CommonPlayer");
                CommonPlayerController player = go.GetComponent<CommonPlayerController>();
                player.ID = entity.id;
                playerDic.Add(entity.id, player);
            }
        }
    }

    // ìƒˆ ì—”í‹°í‹° ì…ì¥
    public void EntityEnter(S_BroadcastEntityEnter pkt)
    {
        GameObject go = ClientManager.Resource.R_Instantiate("Player/CommonPlayer");
        CommonPlayerController player = go.GetComponent<CommonPlayerController>();
        player.ID = pkt.id;
        playerDic.Add(pkt.id, player);
    }

    // ì—”í‹°í‹° í‡´ì¥
    public void EntityLeave(S_BroadcastEntityLeave pkt)
    {
        if (playerDic.TryGetValue(pkt.id, out CommonPlayerController player))
        {
            ClientManager.Resource.R_Destroy(player.gameObject);
            playerDic.Remove(pkt.id);
        }
    }
}
```

## ğŸš€ ì„±ëŠ¥ íŠ¹ì„±

### ë„¤íŠ¸ì›Œí¬ ìµœì í™”
- **íŒ¨í‚· ë°°ì¹­** : ì†¡ì‹  íë¡œ ì—¬ëŸ¬ íŒ¨í‚·ì„ ë¬¶ì–´ì„œ í•œ ë²ˆì— ì „ì†¡
- **ì„ íƒì  ì—…ë°ì´íŠ¸** : ìƒíƒœ ë³€í™” ì‹œì—ë§Œ íŒ¨í‚· ì „ì†¡ (ì• ë‹ˆë©”ì´ì…˜, íšŒì „)
- **ì£¼ê¸°ì  ìœ„ì¹˜ ë™ê¸°í™”** : 100ms (10 Hz) - ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ì™€ ë°˜ì‘ì„±ì˜ ê· í˜•

### ë©”ëª¨ë¦¬ ìµœì í™”
- **ì˜¤ë¸Œì íŠ¸ í’€ë§** : ì´í™íŠ¸, íˆ¬ì‚¬ì²´ ë“± ìì£¼ ìƒì„±/íŒŒê´´ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ ì¬ì‚¬ìš©
- **ë¦¬ì†ŒìŠ¤ ìºì‹±** : ResourceManagerì—ì„œ ë¡œë“œí•œ ë¦¬ì†ŒìŠ¤ ìºì‹±
- **GC ì••ë ¥ ê°ì†Œ** : ì˜¤ë¸Œì íŠ¸ í’€ë§ìœ¼ë¡œ ë©”ëª¨ë¦¬ í• ë‹¹ ìµœì†Œí™”

### ë Œë”ë§ ìµœì í™”
- **ë™ì  í”„ë ˆì„ ì¡°ì •** : í¬ì»¤ìŠ¤ ì‹œ 144 FPS, ë¹„í¬ì»¤ìŠ¤ ì‹œ 60 FPS
- **LOD ì‹œìŠ¤í…œ** : ê±°ë¦¬ì— ë”°ë¥¸ ëª¨ë¸ ë””í…Œì¼ ì¡°ì •
- **Occlusion Culling** : ë³´ì´ì§€ ì•ŠëŠ” ì˜¤ë¸Œì íŠ¸ ë Œë”ë§ ì œì™¸

### ìŠ¤ë ˆë“œ ì•ˆì „ì„±
- **Dispatcher íŒ¨í„´** : Unity API í˜¸ì¶œì„ ë©”ì¸ ìŠ¤ë ˆë“œë¡œ ë§ˆìƒ¬ë§
- **Lock ê¸°ë°˜ ë™ê¸°í™”** : íŒ¨í‚· í ì ‘ê·¼ ì‹œ ë°ì´í„° ë ˆì´ìŠ¤ ë°©ì§€
- **ë‹¨ì¼ ìŠ¤ë ˆë“œ ê²Œì„ ë¡œì§** : Unity ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œë§Œ ê²Œì„ ìƒíƒœ ë³€ê²½
